#!/usr/bin/env bash
# Installs mcp-stdio-toolbox via uv tool

set -euo pipefail

# Skip during Docker build to avoid disk space issues
if [ -f /.dockerenv ] || [ -n "${DOCKER_BUILD:-}" ]; then
  echo "ğŸ³ Skipping mcp-stdio-toolbox installation during Docker build"
  echo "ğŸ’¡ Can be installed later with:"
  echo "  uv tool install mcp-stdio-toolbox"
  exit 0
fi

# â”€â”€ Ensure ~/.local/bin is in PATH (for uv-installed tools) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if [[ ":$PATH:" != *":$HOME/.local/bin:"* ]]; then
  export PATH="$HOME/.local/bin:$PATH"
fi
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# â”€â”€ Load Nix environment; ensure ~/.nix-profile/bin is in PATH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if [ -f "$HOME/.nix-profile/etc/profile.d/nix.sh" ]; then
  . "$HOME/.nix-profile/etc/profile.d/nix.sh"
fi
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# safety-check: uv must already be on the PATH
command -v uv >/dev/null || { echo "âŒ uv is not installed"; exit 1; }

echo "ğŸ”§ Installing mcp-stdio-toolbox..."

# install mcp-stdio-toolbox into uv's global toolchain
uv tool install \
  --force \
  mcp-stdio-toolbox

echo "âœ… mcp-stdio-toolbox installed successfully"
echo "ğŸ’¡ Usage: Run MCP servers with stdio transport using mcp-stdio-toolbox"